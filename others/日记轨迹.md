## 日历显示

前端模块使用的技术 `echarts`

# 显示近三年的每日轨迹

## 1.准备前端页面

搭建前端显示   仿照github活跃图

解决 d3.csv 不能加载本地文件

` nmp install http-server`

csv文件的格式如下:

```bash
day,title,longitude,latitude,num
2021/8/1 18:24,title1,1,101,1
2021/8/2,title2,2,102,2
```

小有bug的同框显示了

![](D:\MyJava\mylifeImg\others\img\image-20210825171252438.png)输出**两次**数量,解决bug

```bashallData.push(
allData.push(
            [csvdata[i].day,
            eval(csvdata[i].num),
            csvdata[i].title,
            csvdata[i].longitude,
            csvdata[i].latitude,
            eval(csvdata[i].num),
            ]
             );
```

## 2.从印象笔记导入坐标数据,爬取信息,写入文件

- 爬取程序
- 按照格式写入到csv文件中

```python
# 配置相关库
import os
from urllib.request import urlopen  # 获取请求打开网页的库
from bs4 import BeautifulSoup  # 获取解析网页的库
import re
from numpy.core.records import fromstring
import pandas as pd
# 正则匹配  20°1'25 N  110°16'23 E

# 目标 值
# 输出到文件中,格式如下
# [日期,标题,经度，纬度,贡献度]
# day,title,longitude,latitude,num
# 2021/8/1 18:24,title1,1,101,1
# 2021/8/2,title2,2,102,2

# 原始值
# <h1>5.168  做核酸  自助早餐  暴雨  两个芒果</h1>
# <div>
# <table bgcolor="#D4DDE5" border="0">
# <tr><td><b>创建时间：</b></td><td><i>2021/7/6 23:01</i></td></tr>
# <tr><td><b>更新时间：</b></td><td><i>2021/7/6 23:17</i></td></tr>
# <tr><td><b>位置：</b></td><td><a href="http://maps.google.com/maps?z=6&q=20.023900,110.269000"><i>20°1'26 N  110°16'8 E</i></a></td></tr>
# # for title in titles:
# 	 print(title.text)
def getNE(s):
    pattern = re.compile(r'\d+\°\d+\'\d+')
    return pattern.findall(s)


def getInfo(fileName, path):
    with open(path, 'r', encoding='utf-8') as f:
        Soup = BeautifulSoup(f.read(), 'html.parser')
    # 获取创建时间 和坐标
    tagBList_i = Soup.findAll({"i"})  # 返回一个包含HTML文档h1标题标签的列表
    if(len(tagBList_i) == 0):
        return []
    longitude, latitude = 0, 0
    if(len(tagBList_i) >= 3):

        if(len(getNE(tagBList_i[2].text)) == 2):
            longitude = getNE(tagBList_i[2].text)[0]
            latitude = getNE(tagBList_i[2].text)[1]
    try:
        day = tagBList_i[0].text
        title = Soup.findAll({"title"})[0].text  # 查找标题对应的内容
    except IndexError:
        print(fileName)
    # print(day,title,longitude,latitude,len(title))
    return [day,title,longitude,latitude,len(title)]
   # 字典中的key值即为csv中列名
   

import numpy as np
#创建数组arr

# dir = 'D:/MyJava/19_mogu_blog_v2-Nacos/others/echart/python/html/'
dir = 'D:/MyJava/19_mogu_blog_v2-Nacos/others/我的抗战1.0/'

result = []
# result = np.array([['day','title','longitude','latitude','num']])
# 遍历输出每一个文件的名字和类型
for item in os.listdir(dir):
    # 输出指定后缀类型的文件
    if(item.endswith('.html')):
        res = getInfo(item, dir+item)
        if(len(getInfo(item, dir+item))>0):
            result.append(res)
        
# print(result)
result = np.array(result)

# 3.写入到文件中
day = result[:,0].tolist()
title = result[:,1].tolist()
longitude = result[:,2].tolist()
latitude = result[:,3].tolist()
num = result[:,4].tolist()
dataframe = pd.DataFrame({'day': day,
                            'title': title,
                            'longitude': longitude,
                            'latitude': latitude,
                            'num': num})

dataframe.to_csv("./echart/python/csv绘图/info.csv",
                    index=False, sep=',')
```

结果处理

- 1.需要处理没有坐标的日记

- 2.将爬取出的数据格式化为html视图可输出的格式

  - ```bash
    day,title,longitude,latitude,num
    2021/8/1 18:24,title1,1,101,1
    2021/8/2,title2,2,102,2
    ```

## 3.从文件读取坐标数据，显示到活跃图上

![image-20210826000355552](D:\MyJava\mylifeImg\others\img\image-20210826000355552.png)

[源文件](D:\MyJava\mylifeImg\others\echart\python\csv绘图\d copy.html)

## 4.数据清理

- 给没有 日期的地方赋值

  - ```bash
    # 1.地理坐标为最近一个gps
    # 2.num 为 0
    # 3.date为空白值
    # 4.title 为空
    ```

### 4.1 找出没有记录的日子 补全

### 4.2 处理结果中重复的日子

![image-20210826234116797](D:\MyJava\mylifeImg\others\img\image-20210826234116797.png)

### 4.3 早上6点的都算是前一天写的日记 因为发现有一天是4点写的

### 4.4 优化去重  去掉2/12   将第一个2/13 改为2/13

![image-20210827222102351](D:\MyJava\mylifeImg\others\img\image-20210827222102351.png)

### 4.5 **将文件按年进行分表**

###  4.6将没有坐标的日子进行临近线性填充

### 4.7年份的切换功能

## 5.地图视角

### 5.1 点击日期 显示~~百度地图~~

![image-20210829185443745](D:\MyJava\mylifeImg\others\img\image-20210829185443745.png)

换用**高德**api，不用转换 显示的经度更高

![image-20210829214010849](D:\MyJava\mylifeImg\others\img\image-20210829214010849.png)
