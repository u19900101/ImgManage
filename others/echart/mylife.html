<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mylife_track</title>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script type="text/javascript"
        src="https://webapi.amap.com/maps?v=1.4.15&key=ce3b1a3a7e67fc75810ce1ba1f83c01a&plugin=AMap.MapType"></script>
    <!-- <style>
        *{margin:0;padding:0;list-style: none;}
        #container {width:100%; height: 100%;top:0;left:0;position: absolute; }  
    </style> -->
    <script src="./data/echarts.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
</head>

<body>
    <button onclick="getYear(this)">2017</button>
    <button onclick="getYear(this)">2018</button>
    <button onclick="getYear(this)">2019</button>
    <button onclick="getYear(this)">2020</button>
    <button onclick="getYear(this)">2021</button>
    <a href="/echart/timeline_trace/my_trace_timeline.html">Timeline</a>
    <a href="/echart/BubbleMap.html">BubbleMap</a>
    <input type="hidden" id="year" value="2021">
    <script>
        function getYear(id) {
            console.log(id.innerHTML)
            document.getElementById("year").value = id.innerHTML;
            show();
        }
    </script>

    <div id="main" style="height: 200px;width:100%;"></div>
    <script>
        show();
        function show() {
            var gpsData_title = [];
            var heatMapData = [];
            var allData = [];
            // var year = document.getElementById("year").innerText;
            var year = document.getElementById("year").value;
            var nextYear = (parseInt(year) + 1).toString()
            //获取csv对象
            d3.csv("./data/" + year + "_info.csv", function (error, csvdata) {
                // d3.csv("./data/我的抗战2.0_2018_info.csv", function (error, csvdata) {
                // d3.csv("../info.csv", function (error, csvdata) {
                console.log("进入文件读取");
                if (error) {
                    console.log(error);
                } else {
                    for (var i = 0; i < csvdata.length; i++) {
                        allData.push(
                            [csvdata[i].day,
                            eval(csvdata[i].num),
                            csvdata[i].title,
                            csvdata[i].longitude,
                            csvdata[i].latitude,
                            eval(csvdata[i].num),
                            ]
                        );
                    }

                    var myChart = echarts.init(document.getElementById("main"));


                    var option = {
                        //设置背景
                        //   backgroundColor: '#d0d0d0',
                        visualMap: {
                            // show: true,
                            min: 0,
                            max: 100,
                            inRange: {
                                color: ['#00c602'],
                                opacity: [0, 1]
                            },
                            controller: {
                                inRange: {
                                    opacity: [0, 1]
                                },
                                outOfRange: {
                                    color: '#ccc'
                                }
                            },
                            seriesIndex: [0],
                        },
                        title: {
                            top: 0,
                            text: '贡献度',
                            // subtext: '一年内提交的数量',
                            left: 'center',
                            textStyle: {
                                color: '#000'
                            }
                        },

                        calendar: [{
                            top: 50,
                            left: 100,
                            // range: contributeDate,
                            range: [year, nextYear],
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    // 设置月份分割线的颜色
                                    color: '#ea0808',
                                    width: 1,
                                    type: 'solid'
                                }
                            },
                            yearLabel: { show: true },
                            dayLabel: {
                                nameMap: ["日", "一", "二", "三", "四", "五", "六"], // 设置中文显示
                                textStyle: {
                                    // 设置周显示颜色
                                    color: '#000'
                                },
                                firstDay: 7 // 从周一开始
                            },
                            monthLabel: {
                                nameMap: 'cn', // 设置中文显示
                                textStyle: {
                                    // 设置月显示颜色
                                    color: '#000'
                                }
                            },
                            // orient: 'vertical',
                            itemStyle: {
                                normal: {
                                    // 设置背景颜色
                                    color: '#ffffff',
                                    borderWidth: 5,
                                    // 设置方块分割线段颜色
                                    // borderColor: 'rgba(211,211,211,0)'
                                    borderColor: 'rgba(3,3,3,0.02)'
                                }
                            }
                        }],
                        tooltip: [{
                            trigger: 'item',
                            formatter: function (params) {
                                // console.log(params)
                                if (params.value[2].length > 80) {
                                    // console.log(params.value[2])
                                    return ('时间：' + params.value[0] + "<br>权重：" + params.value[1] +
                                        "<br>标题：" + params.value[2].slice(0, 40) +
                                        "<br>" + params.value[2].slice(40, 80) +
                                        "<br>" + params.value[2].slice(80, -1) +
                                        "<br>经度：" + params.value[3] + "<br>纬度：" + params.value[4])
                                } else if (params.value[2].length > 40) {
                                    // console.log(params.value[2])
                                    return ('时间：' + params.value[0] + "<br>权重：" + params.value[1] +
                                        "<br>标题：" + params.value[2].slice(0, 40) +

                                        "<br>   " + params.value[2].slice(40, -1) +
                                        "<br>经度：" + params.value[3] + "<br>纬度：" + params.value[4])
                                } else {
                                    return ('时间：' + params.value[0] + "<br>权重：" + params.value[1] +
                                        "<br>标题：" + params.value[2] +
                                        "<br>经度：" + params.value[3] + "<br>纬度：" + params.value[4])
                                }

                            },
                            // position: 'right'
                            // 设置框的大小
                            textStyle: {
                                width: 10,
                                overflow: "break"
                            }
                        }],

                        series: [{
                            type: 'heatmap',
                            name: '数量',
                            coordinateSystem: 'calendar',
                            data: allData,
                        },

                        ]
                    };
                    myChart.setOption(option);
                    myChart.on('click', function (params) {

                        // console.log(params);
                        console.log(
                            "时间:", params.value[0],
                            "大小：", params.value[1],
                            "标题：", params.value[2],
                            "经度：", params.value[3],
                            "纬度: ", params.value[4]);
                        // window.open('https://www.baidu.com/s?wd=' + encodeURIComponent(params.name));

                        longitude = params.value[3]
                        latitude = params.value[4]
                        console.log("gps is ", longitude, latitude)

                        showMap(latitude, longitude);
                        // var gps = latitude + ',' + longitude
                        // //   https://www.google.com/maps/@31.0058333,114.3189224,17z?hl=zh-cn
                        // console.log('https://www.google.com/maps/@'+gps+',4z?hl=zh-cn')
                        // window.open('https://www.google.com/maps/@'+gps+',4z?hl=zh-cn');
                    });
                }
            });

        }
    </script>
    <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3415.810521221901!2d114.1664603151151!3d31.114997981505454!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x342c75a1f1eb64cd%3A0x51f172503f0ec0b7!2z5Liw5bGx5Lit5a2m!5e0!3m2!1szh-CN!2s!4v1630211402348!5m2!1szh-CN!2s" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe> -->
    <!-- 高德 -->
    <div id="container-AMap" style="width:100%; height:400px; position: relative"></div>
    <script type="text/javascript">
        $(function () {
            showMap(30.5857328, 114.3047429); //初始坐标
        })

        //传入坐标，然后跳转到该位置
        function showMap(lat, lng) {
            // lng = 114.33388888888888
            // lat = 30.669722222222223

            var map = new AMap.Map('container-AMap', {
                center: [lng, lat],
                zoom: 15,
               
            });


            var marker = new AMap.Marker({
                position: new AMap.LngLat(lng, lat),   // 经纬度对象，也可以是经纬度构成的一维数组[119.920486,30.245285]
                // title: '方恒国际酒店'
            });
            //==================异步加载1个插件==================
            AMap.plugin('AMap.ToolBar', function () {//异步加载插件
                var toolbar = new AMap.ToolBar();
                map.addControl(toolbar);
            });

            // 将创建的点标记添加到已有的地图实例：
            map.add(marker);

            map.addControl(new AMap.MapType({
                defaultType: 1 //0代表默认，1代表卫星
            }));
        }
    </script>
</body>

</html>